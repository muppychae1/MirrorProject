<!DOCTYPE html>
<html>
    <head>
        <title>Login & Sign up</title>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="css/init.css">
        <link rel="stylesheet" type="text/css" href="css/loading.css">
        <script src="loading.js"></script>
        <script>   
            const client = require("./mqtt");
            let loginBtnFlag = false;
            let signUpBtnFlag = false;

            let btn;
            let btnText="";

            client.subscribe('error'); // face not found
            client.on('message', (topic, message, packet) =>{
                if(topic == "error"){
                    console.log("error");
                    var msg = String(message);
                    
                    const warningText = "Face Not Found";

                    if(loginBtnFlag){
                        btn = document.getElementById("loginBtn");
                        btnText = "Login";
                        loginBtnFlag = false;
                    }
                    else if(signUpBtnFlag){
                        btn = document.getElementById("signUpBtn");
                        btnText = "Sign Up";
                        signUpBtnFlag = false;
                    }

                    if(msg == "notFound"){
                        btn.textContent  = warningText;
                        btn.setAttribute("style", "color: red; border: solid 3px red; box-shadow: 0 0 25px red;");
                    }
                    else {
                        btn.textContent = btnText;
                        btn.setAttribute("style", "color: white; border: solid 2px white;");
                    }
                }
            })
            // 로그인 start
            function login(){
                // console.log("login()");
                loading();
                loginBtnFlag = true;
                client.publish('loginCamera',"login");
            }

            // 회원가입 start
            function signUp(){
                // console.log('signUp()');
                loading();
                signUpBtnFlag = true;
                client.publish('existingUser', 'ok')
            }

            function deleteUser(){
                document.location.href = 'delete.html'
            }

            //재학습 시키기
            function model(){
                client.publish('reTrain', '')
            }
        </script>
    </head>
    <body>
        <div id="loadingDiv">
            <div id="loading" style="display: none;"></div>
        </div>
        <div class="container">
            <div class="btnDiv" id="loginDiv"><button class="btn" id="loginBtn" onclick="login()">Login</button></div>
            <div class="btnDiv" id="signUpDiv"><button class="btn" id="signUpBtn" onclick="signUp()">Sign Up</button></div>
            <div class="btnDiv" id="deleteDiv"><button class="btn" id="deleteBtn" onclick="deleteUser()">삭제</button></div>
            <div class="btnDiv" id="modelDiv"><button class="btn" id="modelBtn" onclick="model()">Train</button></div>
        </div>
        <div id="message"></div>
    </body>
</html>